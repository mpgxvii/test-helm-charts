{{- $root := . -}}
{{- range $name, $svc := .Values.services }}
{{- if and $svc.enabled $svc.config (default true $svc.config.enabled) (or $svc.config.values $svc.config.data) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "platform-backend.serviceFullname" (dict "root" $root "serviceName" $name) }}-config
  labels:
    {{- include "platform-backend.labels" (dict "root" $root "serviceName" $name) | nindent 4 }}
data:
  {{- if $svc.config.values }}
  config.yaml: |
{{ toYaml $svc.config.values | nindent 4 }}
  {{- else if $svc.config.data }}
  {{- toYaml $svc.config.data | nindent 2 }}
  {{- end }}
---
{{- end }}
{{- end }}
